pipeline:
  test:
    image: rust:1.43
    commands:
      - cargo build --no-default-features
      - cargo test --no-default-features

  publish_latest:
    image: plugins/docker
    repo: seabirdchat/seabird-core:latest
    secrets: [ docker_username, docker_password ]
    when:
      branch: main

  publish_next:
    image: plugins/docker
    repo: seabirdchat/seabird-core:next
    secrets: [ docker_username, docker_password ]
    when:
      branch: develop
